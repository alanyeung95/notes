## ginkgo

A Golang Behavior-Driven Development ("BDD") testing framework

Example

```
Describe("the strings package", func() {
  Context("strings.Contains()", func() {
    When("the string contains the substring in the middle", func() {
      It("returns `true`", func() {
        Expect(strings.Contains("Ginkgo is awesome", "is")).To(BeTrue())
      })
    })
  })
})
```

## gomock & gomega

1. Define an Interface: Ensure that the dependency you want to mock is defined as an interface in Go.

```
package items

import "context"

//go:generate mockgen -destination=../mocks/mock_items/mock_repository.go -package=mock_items github.com/alanyeung95/GoProjectDemo/pkg/items Repository

// Repository is the item repo
type Repository interface {
	Upsert(ctx context.Context, id string, item Item) (*Item, error)
	Find(ctx context.Context, id string) (*Item, error)
	Update(ctx context.Context, id string, model interface{}) error
}
```

2. Generate Mocks: Use the mockgen tool provided by gomock to generate mock implementations of your interfaces.

```
// Code generated by MockGen. DO NOT EDIT.
// Source: github.com/alanyeung95/GoProjectDemo/pkg/items (interfaces: Repository)

// Package mock_items is a generated GoMock package.
package mock_items

import (
	context "context"
	items "github.com/alanyeung95/GoProjectDemo/pkg/items"
	gomock "github.com/golang/mock/gomock"
	reflect "reflect"
)

// MockRepository is a mock of Repository interface
type MockRepository struct {
	ctrl     *gomock.Controller
	recorder *MockRepositoryMockRecorder
}

// MockRepositoryMockRecorder is the mock recorder for MockRepository
type MockRepositoryMockRecorder struct {
	mock *MockRepository
}
...
```

3. Write Tests:
   - In your test files, create an instance of the mock object.
   - Use the gomock.Controller to manage the lifecycle of your mocks.
   - Set up expectations on the mock object (what methods should be called, with what arguments, what should they return, etc.).
   - Run your tests and verify that the interactions with your mock objects follow the specified expectations.

```
package items_test

import (
	"context"
	"testing"

	"github.com/golang/mock/gomock"
	. "github.com/onsi/ginkgo"
	. "github.com/onsi/gomega"

	"github.com/alanyeung95/GoProjectDemo/pkg/items"
	"github.com/alanyeung95/GoProjectDemo/pkg/mocks/mock_items"
)

func TestCreateItem(t *testing.T) {
	RegisterFailHandler(Fail)

	mockCtrl := gomock.NewController(t)
	defer mockCtrl.Finish()

	mockRepo := mock_items.NewMockRepository(mockCtrl)
	expectedResponse := &items.Item{}
	mockRepo.EXPECT().Upsert(gomock.Any(), gomock.Any(), gomock.Any()).Return(expectedResponse, nil)
	service := items.NewService(mockRepo)

	resp, err := service.CreateItem(context.TODO(), nil, &items.Item{ID: "123"})
	Expect(err).ShouldNot(HaveOccurred())
	Expect(resp).ShouldNot(BeNil())

}
...
```

4. Run and Verify: Execute your tests and use the controller to verify that all expectations were met.
